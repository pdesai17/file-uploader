{"version":3,"file":"until-D5ij_p5W.js","names":["value: unknown","stream: ReadableStream<WorkflowEventData<any>>","cond:\n    | ((event: WorkflowEventData<any>) => boolean | Promise<boolean>)\n    | WorkflowEvent<any>","reader: ReadableStreamDefaultReader<WorkflowEventData<any>> | null"],"sources":["../src/stream/until.ts"],"sourcesContent":["import type { WorkflowEvent, WorkflowEventData } from \"@llama-flow/core\";\n\nconst isWorkflowEvent = (value: unknown): value is WorkflowEvent<any> =>\n  value != null &&\n  typeof value === \"object\" &&\n  \"with\" in value &&\n  \"include\" in value;\n\nexport function until(\n  stream: ReadableStream<WorkflowEventData<any>>,\n  cond: (event: WorkflowEventData<any>) => boolean | Promise<boolean>,\n): ReadableStream<WorkflowEventData<any>>;\nexport function until<Stop>(\n  stream: ReadableStream<WorkflowEventData<any>>,\n  cond: WorkflowEvent<Stop>,\n): ReadableStream<WorkflowEventData<any> | WorkflowEventData<Stop>>;\nexport function until(\n  stream: ReadableStream<WorkflowEventData<any>>,\n  cond:\n    | ((event: WorkflowEventData<any>) => boolean | Promise<boolean>)\n    | WorkflowEvent<any>,\n): ReadableStream<WorkflowEventData<any>> {\n  let reader: ReadableStreamDefaultReader<WorkflowEventData<any>> | null = null;\n  return new ReadableStream<WorkflowEventData<any>>({\n    start: () => {\n      reader = stream.getReader();\n    },\n    pull: async (controller) => {\n      const { done, value } = await reader!.read();\n      if (value) {\n        controller.enqueue(value);\n      }\n      if (done) {\n        reader!.releaseLock();\n        reader = null;\n        controller.close();\n      } else {\n        if (isWorkflowEvent(cond) && cond.include(value)) {\n          reader!.releaseLock();\n          controller.close();\n        } else if (typeof cond === \"function\" && (await cond(value))) {\n          reader!.releaseLock();\n          controller.close();\n        }\n      }\n    },\n  });\n}\n"],"mappings":";AAEA,MAAM,kBAAkB,CAACA,UACvB,SAAS,eACF,UAAU,YACjB,UAAU,SACV,aAAa;AAUf,SAAgB,MACdC,QACAC,MAGwC;CACxC,IAAIC,SAAqE;AACzE,QAAO,IAAI,eAAuC;EAChD,OAAO,MAAM;AACX,YAAS,OAAO,WAAW;EAC5B;EACD,MAAM,OAAO,eAAe;GAC1B,MAAM,EAAE,MAAM,OAAO,GAAG,MAAM,OAAQ,MAAM;AAC5C,OAAI,MACF,YAAW,QAAQ,MAAM;AAE3B,OAAI,MAAM;AACR,WAAQ,aAAa;AACrB,aAAS;AACT,eAAW,OAAO;GACnB,WACK,gBAAgB,KAAK,IAAI,KAAK,QAAQ,MAAM,EAAE;AAChD,WAAQ,aAAa;AACrB,eAAW,OAAO;GACnB,kBAAiB,SAAS,cAAe,MAAM,KAAK,MAAM,EAAG;AAC5D,WAAQ,aAAa;AACrB,eAAW,OAAO;GACnB;EAEJ;CACF;AACF"}