import { collect } from "./consumer-BKe0ue3v.js";
import { until } from "./until-D5ij_p5W.js";

//#region src/stream/run.ts
/**
* Runs a workflow with a specified input event and returns the first matching event of the specified output type.
*
* @example
* ```ts
* const result = await runWorkflow(workflow, startEvent.with("42"), stopEvent);
* console.log(`Result: ${result.data === 1 ? 'positive' : 'negative'}`);
* ```
*/
async function runWorkflow(workflow, inputEvent, outputEvent) {
	const { stream, sendEvent } = workflow.createContext();
	sendEvent(inputEvent);
	const untilStream = until(stream, outputEvent);
	for await (const event of untilStream) if (outputEvent.include(event)) return event;
	throw new Error(`No matching ${outputEvent.toString()} event found`);
}
/**
* Runs a workflow with a specified input event and collects all events until a specified output event is encountered.
* Returns an array containing all events including the final output event.
*
* @example
* ```ts
* const allEvents = await runAndCollect(workflow, startEvent.with("42"), stopEvent);
* const finalEvent = allEvents[allEvents.length - 1];
* console.log(`Result: ${finalEvent.data === 1 ? 'positive' : 'negative'}`);
* ```
*/
async function runAndCollect(workflow, inputEvent, outputEvent) {
	const { stream, sendEvent } = workflow.createContext();
	sendEvent(inputEvent);
	return await collect(until(stream, outputEvent));
}
/**
* Runs a workflow with a specified input event and returns an async iterable stream of all events
* until a specified output event is encountered.
*
* This allows processing events one by one without collecting them all upfront.
*
* @example
* ```ts
* const eventStream = runStream(workflow, startEvent.with("42"), stopEvent);
* for await (const event of eventStream) {
*   console.log(`Processing event: ${event}`);
*   // Do something with each event as it arrives
* }
* ```
*/
function runStream(workflow, inputEvent, outputEvent) {
	const { stream, sendEvent } = workflow.createContext();
	sendEvent(inputEvent);
	return until(stream, outputEvent);
}

//#endregion
export { runAndCollect, runStream, runWorkflow };
//# sourceMappingURL=run.js.map